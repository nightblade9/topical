<div id="main">
    <form onsubmit="onSearch(); return false // don't postback">
        <label for="query">Search:</label>
        <input id="query" type="text" />
        <input type="submit" value="Search">
    </form>

    <label id="output" />
</div>

<script type="text/javascript">
    // TODO: externailze in .js file
    setContent = (html) => {
        document.getElementById("output").innerHTML = html;
    }

    main = () => {
        var queryParameters = location.search.slice(1).split("&");
        for (var i = 0; i < queryParameters.length; i++)
        {
            var params = queryParameters[i].split('=');
            var key = params[0];
            var value = params[1];
            if (key.toLowerCase() == "query") {
                this.onSearch(value);
                break;
            }
        }
    }

    onSearch = (searchQuery) => {
        // Make sure the document is ready and window.data is defined, before proceeding.
        document.addEventListener("DOMContentLoaded", (event) => {

            if (searchQuery == null)
            {
                // came from a form submission, not a parameter
                searchQuery = document.getElementById("query").value;
            }
            
            searchQuery = decodeURI(searchQuery);
            document.getElementById("query").value = searchQuery;

            var allData = JSON.parse(window.data);

            // Too hard/complicated to write as a single lambda/filter
            var matchingItems = [];
            for (var i = 0; i < allData.length; i++)
            {
                var item = allData[i];
                var tags = item["tags"];
                for (var j = 0; j < tags.length; j++)
                {
                    if (tags[j].toLowerCase() == searchQuery.toLowerCase())
                    {
                        matchingItems.push(item);
                        break;
                    }
                }
            }
            
            this.setContent("Matches: " + matchingItems);
        });
    }

    main();

</script>